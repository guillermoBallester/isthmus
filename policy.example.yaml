# Isthmus Policy File — Data Dictionary + Column Masking
#
# This file enriches MCP tool responses (describe_table, list_tables) with
# business descriptions so the LLM understands what each table and column means.
# It also defines column-level masking to protect PII in query results and
# profile_table sample rows.
#
# Usage:
#   POLICY_FILE=policy.yaml isthmus
#
# Keys are fully-qualified: schema.table_name
# YAML descriptions only fill empty comments — Postgres COMMENT ON values
# always take precedence.
#
# Column formats:
#   column_name: "description"                       # plain description, no masking
#   column_name:                                     # expanded format with masking
#     description: "description"
#     mask: "redact"                                 # redact | hash | partial | null
#
# Mask types:
#   redact  — replaces value with "***"
#   hash    — deterministic SHA-256 hex (64 chars), preserves GROUP BY / JOIN
#   partial — shows last 4 characters, masks the rest with asterisks
#   null    — replaces value with NULL

context:
  tables:
    public.customers:
      description: "Registered platform customers. One row per customer account."
      columns:
        id: "Unique customer identifier (UUID)"
        email:
          description: "Primary email address, used for login and notifications"
          mask: "redact"
        name:
          description: "Full display name"
          mask: "partial"
        phone:
          description: "Contact phone number"
          mask: "partial"
        ssn:
          description: "Social Security Number (US)"
          mask: "null"
        created_at: "Account creation timestamp (UTC)"

    public.orders:
      description: "Purchase orders. Lifecycle: draft -> pending -> paid -> shipped -> delivered."
      columns:
        id: "Unique order identifier (UUID)"
        customer_id: "FK to customers.id — the buyer"
        status: "Order status: draft, pending, paid, shipped, delivered, cancelled"
        amount_cents: "Order total in cents (USD), before tax"
        created_at: "Order creation timestamp (UTC)"

    public.products:
      description: "Product catalog. Each row is a distinct SKU."
      columns:
        id: "Unique product identifier (UUID)"
        name:
          description: "Product display name"
          mask: "partial"
        price_cents: "Unit price in cents (USD)"
        category: "Product category for filtering and reporting"
        stock: "Current inventory count"
